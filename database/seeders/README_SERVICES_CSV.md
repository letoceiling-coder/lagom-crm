# Инструкция по подготовке и выполнению ServicesFromCsvSeeder

## ✅ Готово! Данные встроены в сидер

**Важно:** Данные из CSV файла уже встроены в `ServicesData.php`. На сервере **НЕ НУЖНО** загружать CSV файлы - просто запустите seed!

## Подготовка данных (выполнено локально)

Данные из CSV файла уже встроены в `database/seeders/ServicesData.php` (1.5 MB).

Если нужно обновить данные из нового CSV файла:
1. Распакуйте архив `111.zip` в папку `C:\Users\dsc-2\Downloads\111_extracted\`
2. Запустите генератор данных:
   ```bash
   php generate-services-data.php
   ```
3. Файл `ServicesData.php` будет обновлен автоматически

### Загрузка изображений на сервер (опционально)

Если нужно загрузить изображения на сервер:

**Примечание:** Изображения опциональны. Сидер будет работать и без них, просто услуги будут без изображений.

1. Подключитесь к серверу через FTP/SFTP
2. Загрузите папку `images/` в `/home/d/dsc23ytp/stroy/public_html/storage/app/services-seed/`

Структура на сервере (опционально):
```
/home/d/dsc23ytp/stroy/public_html/storage/app/services-seed/
└── images/
    ├── services/
    └── icons/
```

### Выполнение сидера на сервере

#### На сервере (через deploy):
```bash
php artisan deploy --with-seed --insecure
```

Или напрямую на сервере:
```bash
cd /home/d/dsc23ytp/stroy/public_html
php artisan db:seed --class=ServicesFromCsvSeeder
```

**Важно:** CSV файл НЕ НУЖЕН на сервере! Все данные уже встроены в `ServicesData.php`.

## Что делает сидер

1. **Очистка данных** (если `CLEAR_SERVICES_BEFORE_SEED=true`):
   - Удаляет все существующие услуги
   - Удаляет все разделы
   - Удаляет все случаи
   - Очищает связи между таблицами

2. **Импорт данных**:
   - Читает CSV файл
   - Создает/обновляет разделы
   - Загружает изображения и иконки в медиа-библиотеку
   - Создает/обновляет услуги с привязкой к разделам и изображениям

3. **Предотвращение дубликатов**:
   - Использует `updateOrCreate` по `slug`
   - Обновляет существующие услуги вместо создания дубликатов

## Структура CSV файла

CSV файл должен содержать следующие колонки (разделитель `;`):
- ID
- Название
- Slug
- Описание (может быть JSON)
- HTML контент
- Раздел ID
- Название раздела
- ID изображения
- Путь изображения
- URL изображения
- ID иконки
- Путь иконки
- URL иконки
- Порядок
- Активен

## Проверка результатов

После выполнения сидера проверьте:
1. Количество услуг в админ-панели: `/admin/decisions/services`
2. Наличие изображений в медиа-библиотеке
3. Привязку услуг к разделам
4. Отсутствие дубликатов

## Устранение проблем

### Файл не найден
- Проверьте путь к файлу
- Убедитесь, что файл загружен на сервер
- Проверьте права доступа к файлу

### Изображения не загружаются
- Проверьте наличие папки `images/services/` и `images/icons/`
- Убедитесь, что файлы изображений существуют
- Проверьте права доступа к папкам

### Дубликаты услуг
- Сидер использует `updateOrCreate` по `slug`, дубликаты не должны создаваться
- Если дубликаты есть, проверьте уникальность slug в CSV

