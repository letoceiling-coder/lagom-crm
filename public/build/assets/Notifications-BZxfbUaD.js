import{_ as q,e as i,h as t,f as u,i as C,v as J,y as S,x as P,t as l,F as j,k as M,g as G,n as y,l as H,w as K,r as m,o as Q,b as W,d as a,m as X}from"./app-IAcy3ZQJ.js";import{S as T}from"./sweetalert2.esm.all-C0u8rGqG.js";const Y={name:"Notifications",setup(){const h=m(!1),o=m(null),k=m([]),e=m(null),p=m({search:"",read:null,type:""}),x=m(1),_=m(20),n=m(null),f=m(null),w=m(!1),v=async(s=1)=>{h.value=!0,o.value=null;try{const r=new URLSearchParams;r.append("page",s),r.append("per_page",_.value),p.value.search&&r.append("search",p.value.search),p.value.read!==null&&r.append("read",p.value.read?"1":"0"),p.value.type&&r.append("type",p.value.type);const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};c&&(g.Authorization=`Bearer ${c}`);const d=await fetch(`/api/notifications/all?${r.toString()}`,{method:"GET",headers:g});if(!d.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π");const b=await d.json();k.value=b.data||[],e.value={current_page:b.current_page||1,last_page:b.last_page||1,per_page:b.per_page||_.value,total:b.total||0,from:b.from||0,to:b.to||0},x.value=b.current_page||1}catch(r){o.value=r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"}finally{h.value=!1}},B=()=>{n.value&&clearTimeout(n.value),n.value=setTimeout(()=>{x.value=1,v(1)},500)},A=()=>{x.value=1,v(1)},z=s=>{v(s)},N=async s=>{try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`),(await fetch(`/api/notifications/${s}/read`,{method:"POST",headers:c})).ok&&await v(x.value)}catch(r){console.error("Error marking notification as read:",r)}},E=async s=>{if((await T.fire({title:"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",text:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};if(c&&(g.Authorization=`Bearer ${c}`),!(await fetch(`/api/notifications/${s}`,{method:"DELETE",headers:g})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");await T.fire({title:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await v(x.value)}catch(c){T.fire({title:"–û—à–∏–±–∫–∞",text:c.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}},D=s=>s?new Date(s).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",V=s=>({info:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",success:"–£—Å–ø–µ—Ö",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",error:"–û—à–∏–±–∫–∞"})[s]||s,F=s=>({info:"bg-blue-500/10 text-blue-500",success:"bg-green-500/10 text-green-500",warning:"bg-yellow-500/10 text-yellow-500",error:"bg-red-500/10 text-red-500"})[s]||"bg-muted text-muted-foreground",L=async s=>{w.value=!0;try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`);const g=await fetch(`/api/notifications/${s.id}`,{method:"GET",headers:c});if(!g.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");const d=await g.json();f.value=d.data,s.read||await N(s.id)}catch(r){console.error("Error loading notification:",r),f.value=s}finally{w.value=!1}},I=()=>{f.value=null},R=async s=>{await N(s),f.value&&(f.value.read=!0,f.value.read_at=new Date().toISOString())},O=s=>s==null?"–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞":typeof s=="object"?s.text?s.text:s.value?s.value:s.name?s.name:s.title?s.title:Array.isArray(s)?s.map(r=>typeof r=="object"?r.name||r.title||JSON.stringify(r):r).join(", "):JSON.stringify(s,null,2):String(s),U=(s,r)=>{const c=[];if(r<=5)for(let d=1;d<=r;d++)c.push(d);else if(s<=3)for(let d=1;d<=5;d++)c.push(d);else if(s>=r-2)for(let d=r-4;d<=r;d++)c.push(d);else for(let d=s-2;d<=s+2;d++)c.push(d);return c};return Q(()=>{v(1)}),{loading:h,error:o,notifications:k,pagination:e,filters:p,handleSearch:B,handleFilterChange:A,handlePageChange:z,markAsRead:N,deleteNotification:E,formatDate:D,getTypeLabel:V,getTypeClass:F,getPageNumbers:U,selectedNotification:f,loadingNotification:w,viewNotification:L,closeNotificationModal:I,markAsReadFromModal:R,formatAnswer:O}}},Z={class:"notifications-page space-y-6"},$={class:"bg-card rounded-lg border border-border p-4"},ee={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},te={class:"md:col-span-2"},oe={class:"relative"},ne={key:0,class:"flex items-center justify-center py-12"},se={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},re={class:"text-destructive"},ie={key:2,class:"space-y-3"},ae={class:"flex items-start justify-between gap-4"},le={class:"flex-1 min-w-0"},de={class:"flex items-center gap-2 mb-2"},ce={class:"font-semibold text-foreground"},ue={key:0,class:"h-2 w-2 bg-accent rounded-full flex-shrink-0",title:"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"},fe={class:"text-sm text-muted-foreground mb-2"},ge={class:"flex items-center gap-4 text-xs text-muted-foreground"},me={key:0},pe={class:"flex items-center gap-2 flex-shrink-0"},be=["onClick"],xe=["onClick"],ve=["onClick"],he={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},_e={key:4,class:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-border gap-4"},ye={class:"text-sm text-muted-foreground"},ke={class:"flex gap-2 items-center"},we=["disabled"],Ne={class:"flex gap-1"},Ce=["onClick"],je=["disabled"],Te={class:"bg-card rounded-lg border border-border shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Se={class:"flex items-center justify-between p-6 border-b border-border"},Me={class:"text-2xl font-semibold text-foreground"},Be={class:"flex items-center gap-2 mt-2"},Ae={class:"text-xs text-muted-foreground"},ze={class:"flex-1 overflow-y-auto p-6"},Ee={class:"space-y-6"},De={class:"text-foreground whitespace-pre-wrap"},Ve={key:0,class:"space-y-4"},Fe={key:0,class:"border-t border-border pt-4"},Le={class:"space-y-3"},Ie={class:"ml-2 text-foreground"},Re={key:0,class:"mt-4"},Oe={class:"bg-muted/50 rounded-lg p-4 space-y-2"},Ue={class:"ml-2 text-foreground"},qe={class:"ml-2 text-foreground"},Je={class:"ml-2 text-foreground"},Pe={key:1,class:"mt-4"},Ge={class:"ml-2 text-foreground"},He={key:2,class:"mt-4"},Ke={class:"text-sm text-muted-foreground mb-3"},Qe={class:"mt-6"},We={key:1,class:"border-t border-border pt-4"},Xe={class:"bg-muted/50 rounded-lg p-4 text-xs overflow-auto"},Ye={class:"flex items-center justify-between p-6 border-t border-border bg-muted/30"},Ze={class:"text-sm text-muted-foreground"},$e={key:0},et={key:1},tt={class:"flex gap-2"};function ot(h,o,k,e,p,x){const _=W("router-link");return a(),i(j,null,[t("div",Z,[o[17]||(o[17]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),t("p",{class:"text-muted-foreground mt-1"},"–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")])],-1)),t("div",$,[t("div",ee,[t("div",te,[t("div",oe,[o[12]||(o[12]=t("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),C(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>e.filters.search=n),onInput:o[1]||(o[1]=(...n)=>e.handleSearch&&e.handleSearch(...n)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[J,e.filters.search]])])]),t("div",null,[C(t("select",{"onUpdate:modelValue":o[2]||(o[2]=n=>e.filters.read=n),onChange:o[3]||(o[3]=(...n)=>e.handleFilterChange&&e.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[13]||(o[13]=[t("option",{value:null},"–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",-1),t("option",{value:!1},"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1),t("option",{value:!0},"–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1)])],544),[[S,e.filters.read]])]),t("div",null,[C(t("select",{"onUpdate:modelValue":o[4]||(o[4]=n=>e.filters.type=n),onChange:o[5]||(o[5]=(...n)=>e.handleFilterChange&&e.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[14]||(o[14]=[P('<option value="">–í—Å–µ —Ç–∏–ø—ã</option><option value="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option><option value="success">–£—Å–ø–µ—Ö</option><option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option><option value="error">–û—à–∏–±–∫–∞</option>',5)])],544),[[S,e.filters.type]])])])]),e.loading?(a(),i("div",ne,[...o[15]||(o[15]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...",-1)])])):u("",!0),e.error?(a(),i("div",se,[t("p",re,l(e.error),1)])):u("",!0),!e.loading&&e.notifications.length>0?(a(),i("div",ie,[(a(!0),i(j,null,M(e.notifications,n=>(a(),i("div",{key:n.id,class:y(["bg-card rounded-lg border p-4 transition-colors",n.read?"border-border":"border-accent bg-accent/5"])},[t("div",ae,[t("div",le,[t("div",de,[t("h3",ce,l(n.title),1),n.read?u("",!0):(a(),i("span",ue)),t("span",{class:y(["px-2 py-1 text-xs rounded",e.getTypeClass(n.type)])},l(e.getTypeLabel(n.type)),3)]),t("p",fe,l(n.message),1),t("div",ge,[t("span",null,l(e.formatDate(n.created_at)),1),n.read_at?(a(),i("span",me," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(e.formatDate(n.read_at)),1)):u("",!0)])]),t("div",pe,[t("button",{onClick:f=>e.viewNotification(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,be),n.read?u("",!0):(a(),i("button",{key:0,onClick:f=>e.markAsRead(n.id),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded transition-colors",title:"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"}," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ ",8,xe)),t("button",{onClick:f=>e.deleteNotification(n.id),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors",title:"–£–¥–∞–ª–∏—Ç—å"}," –£–¥–∞–ª–∏—Ç—å ",8,ve)])])],2))),128))])):u("",!0),!e.loading&&e.notifications.length===0?(a(),i("div",he,[...o[16]||(o[16]=[t("p",{class:"text-muted-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):u("",!0),e.pagination&&e.pagination.last_page>1?(a(),i("div",_e,[t("div",ye,[t("span",null," –ü–æ–∫–∞–∑–∞–Ω–æ "+l(e.pagination.from)+"-"+l(e.pagination.to)+" –∏–∑ "+l(e.pagination.total),1)]),t("div",ke,[t("button",{onClick:o[6]||(o[6]=n=>e.handlePageChange(e.pagination.current_page-1)),disabled:e.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,we),t("div",Ne,[(a(!0),i(j,null,M(e.getPageNumbers(e.pagination.current_page,e.pagination.last_page),n=>(a(),i("button",{key:n,onClick:f=>e.handlePageChange(n),class:y(["px-3 py-2 rounded-md border text-sm transition-colors min-w-[40px]",n===e.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},l(n),11,Ce))),128))]),t("button",{onClick:o[7]||(o[7]=n=>e.handlePageChange(e.pagination.current_page+1)),disabled:e.pagination.current_page===e.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,je)])])):u("",!0)]),e.selectedNotification?(a(),i("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:o[11]||(o[11]=G((...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n),["self"]))},[t("div",Te,[t("div",Se,[t("div",null,[t("h2",Me,l(e.selectedNotification.title),1),t("div",Be,[t("span",{class:y(["px-2 py-1 text-xs rounded",e.getTypeClass(e.selectedNotification.type)])},l(e.getTypeLabel(e.selectedNotification.type)),3),t("span",Ae,l(e.formatDate(e.selectedNotification.created_at)),1)])]),t("button",{onClick:o[8]||(o[8]=(...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n)),class:"p-2 hover:bg-muted/10 rounded-lg transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å"},[...o[18]||(o[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ze,[t("div",Ee,[t("div",null,[o[19]||(o[19]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ",-1)),t("p",De,l(e.selectedNotification.message),1)]),e.selectedNotification.data?(a(),i("div",Ve,[e.selectedNotification.data.quiz_id?(a(),i("div",Fe,[o[27]||(o[27]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-4"},"–î–µ—Ç–∞–ª–∏ –∫–≤–∏–∑–∞",-1)),t("div",Le,[t("div",null,[o[20]||(o[20]=t("span",{class:"text-sm font-medium text-muted-foreground"},"–ö–≤–∏–∑:",-1)),t("span",Ie,l(e.selectedNotification.data.quiz_title),1)]),e.selectedNotification.data.contact?(a(),i("div",Re,[o[24]||(o[24]=t("h4",{class:"text-sm font-semibold text-foreground mb-2"},"–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),t("div",Oe,[t("div",null,[o[21]||(o[21]=t("span",{class:"text-sm text-muted-foreground"},"–ò–º—è:",-1)),t("span",Ue,l(e.selectedNotification.data.contact.name),1)]),t("div",null,[o[22]||(o[22]=t("span",{class:"text-sm text-muted-foreground"},"Email:",-1)),t("span",qe,l(e.selectedNotification.data.contact.email),1)]),t("div",null,[o[23]||(o[23]=t("span",{class:"text-sm text-muted-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω:",-1)),t("span",Je,l(e.selectedNotification.data.contact.phone),1)])])])):u("",!0),e.selectedNotification.data.completed_at?(a(),i("div",Pe,[o[25]||(o[25]=t("span",{class:"text-sm text-muted-foreground"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),t("span",Ge,l(e.formatDate(e.selectedNotification.data.completed_at)),1)])):u("",!0),e.selectedNotification.data.answers&&e.selectedNotification.data.answers.length>0?(a(),i("div",He,[t("p",Ke," –û—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã: "+l(e.selectedNotification.data.answers.length),1)])):u("",!0),t("div",Qe,[H(_,{to:`/admin/notifications/quiz/${e.selectedNotification.data.quiz_id}?notification_id=${e.selectedNotification.id}`,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"},{default:K(()=>[...o[26]||(o[26]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),X(" –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–≤–∏–∑–∞ ",-1)])]),_:1},8,["to"])])])])):(a(),i("div",We,[o[28]||(o[28]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",-1)),t("pre",Xe,l(JSON.stringify(e.selectedNotification.data,null,2)),1)]))])):u("",!0)])]),t("div",Ye,[t("div",Ze,[e.selectedNotification.read_at?(a(),i("span",$e," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(e.formatDate(e.selectedNotification.read_at)),1)):(a(),i("span",et," –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ "))]),t("div",tt,[e.selectedNotification.read?u("",!0):(a(),i("button",{key:0,onClick:o[9]||(o[9]=n=>e.markAsReadFromModal(e.selectedNotification.id)),class:"px-4 py-2 text-sm bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors"}," –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ ")),t("button",{onClick:o[10]||(o[10]=(...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n)),class:"px-4 py-2 text-sm border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," –ó–∞–∫—Ä—ã—Ç—å ")])])])])):u("",!0)],64)}const rt=q(Y,[["render",ot]]);export{rt as default};
