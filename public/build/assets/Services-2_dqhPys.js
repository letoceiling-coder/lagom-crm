import{_ as T,c as i,b as t,d as w,a as S,t as d,w as z,F as E,k as I,h as x,j as F,r as L,o as a,f as D}from"./app-DjbLLr-W.js";import{a as M,d as V}from"./api-V9GPpd21.js";import{S as u}from"./sweetalert2.esm.all-C0u8rGqG.js";const A={name:"DecisionServices",setup(){const b=x(!1),r=x(!1),v=x(!1),e=x(null),y=x([]),g=async()=>{b.value=!0,e.value=null;try{const s=await M("/services");if(!s.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥");const l=await s.json();y.value=l.data||[]}catch(s){e.value=s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥",console.error("Error fetching services:",s)}finally{b.value=!1}},h=async(s="csv")=>{r.value=!0;try{const l=localStorage.getItem("token"),m=await fetch(`/api/v1/services/export${s==="zip"?"?format=zip":""}`,{method:"GET",headers:{Authorization:`Bearer ${l}`,Accept:s==="zip"?"application/zip":"text/csv"}});if(!m.ok)throw new Error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥");const k=await m.blob(),p=window.URL.createObjectURL(k),o=document.createElement("a");o.href=p;const _=s==="zip"?"zip":"csv";o.download=`services_${new Date().toISOString().split("T")[0]}.${_}`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(p),document.body.removeChild(o),await u.fire({title:"–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(l){await u.fire({title:"–û—à–∏–±–∫–∞",text:l.message||"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥",icon:"error",confirmButtonText:"–û–ö"})}finally{r.value=!1}},n=async s=>{const l=s.target.files?.[0];if(!l)return;const f=100*1024*1024;if(l.size>f){await u.fire({title:"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π",html:`
                        <p>–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: <strong>${(l.size/1024/1024).toFixed(2)} MB</strong></p>
                        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <strong>100 MB</strong></p>
                        <p class="mt-4 text-sm text-gray-600">–ï—Å–ª–∏ —Ñ–∞–π–ª –º–µ–Ω—å—à–µ 100MB, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:</p>
                        <ul class="mt-2 text-sm text-left list-disc list-inside text-gray-600">
                            <li>PHP: upload_max_filesize, post_max_size</li>
                            <li>–í–µ–±-—Å–µ—Ä–≤–µ—Ä: client_max_body_size (nginx) –∏–ª–∏ LimitRequestBody (apache)</li>
                        </ul>
                    `,icon:"error",confirmButtonText:"–û–ö"}),s.target.value="";return}v.value=!0;try{const m=new FormData;m.append("file",l);const k=localStorage.getItem("token"),p=await fetch("/api/v1/services/import",{method:"POST",headers:{Authorization:`Bearer ${k}`},body:m});if(p.status===413)throw new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100MB. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (upload_max_filesize, post_max_size).");let o;try{o=await p.json()}catch{throw p.status===413?new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (413 Content Too Large). –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."):new Error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞")}if(!p.ok){const c=o?.message||o?.errors?.[0]||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥";throw new Error(c)}let _="";o.errors&&o.errors.length>0&&(_=`
                        <details class="mt-4 text-left" open>
                            <summary class="cursor-pointer text-sm font-semibold mb-2">–û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (${o.errors.length})</summary>
                            <div class="mt-2 max-h-60 overflow-y-auto text-xs space-y-2">
                                ${o.errors.map(c=>{const C=Array.isArray(c.errors)?c.errors.join("<br>"):c.errors,j=c.data?`<br><small class="text-gray-500">–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(c.data).substring(0,100)}...</small>`:"";return`<div class="p-2 bg-red-50 border border-red-200 rounded">
                                        <strong>–°—Ç—Ä–æ–∫–∞ ${c.row}:</strong><br>
                                        <span class="text-red-700">${C}</span>
                                        ${j}
                                    </div>`}).join("")}
                            </div>
                        </details>
                    `),await u.fire({title:o.success_count>0?"–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω":"–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —Å –æ—à–∏–±–∫–∞–º–∏",html:`
                        <div class="text-left">
                            <p class="mb-2"><strong>–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong> ${o.success_count||0}</p>
                            <p class="mb-4"><strong>–ü—Ä–æ–ø—É—â–µ–Ω–æ:</strong> ${o.skip_count||0}</p>
                            ${_}
                        </div>
                    `,icon:o.success_count>0?o.errors&&o.errors.length>0?"warning":"success":"error",confirmButtonText:"–û–ö",width:"600px"}),s.target.value="",await g()}catch(m){await u.fire({title:"–û—à–∏–±–∫–∞",text:m.message||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥",icon:"error",confirmButtonText:"–û–ö"})}finally{v.value=!1}},B=async s=>{if((await u.fire({title:"–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É?",text:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É "${s.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626"})).isConfirmed)try{if(!(await V(`/services/${s.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏");await u.fire({title:"–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await g()}catch(f){await u.fire({title:"–û—à–∏–±–∫–∞",text:f.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏",icon:"error",confirmButtonText:"–û–ö"})}};return F(()=>{g()}),{loading:b,exporting:r,importing:v,error:e,services:y,fetchServices:g,deleteService:B,exportServices:h,handleImportFile:n}}},N={class:"services-page space-y-6"},O={class:"flex items-center justify-between"},P={class:"flex items-center gap-3"},R=["disabled"],U={key:0},G={key:1},H=["disabled"],Z={key:0},q={key:1},J={class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 cursor-pointer"},K=["disabled"],Q={key:0},W={key:1},X={key:0,class:"flex items-center justify-center py-12"},Y={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},$={class:"text-destructive"},ee={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},te={class:"divide-y divide-border"},re={class:"flex-1"},oe={class:"font-medium text-foreground"},se={class:"text-sm text-muted-foreground"},ne={class:"flex items-center gap-2"},ie=["onClick"],ae={key:3,class:"text-center py-12 bg-card rounded-lg border border-border"};function le(b,r,v,e,y,g){const h=L("router-link");return a(),i("div",N,[t("div",O,[r[4]||(r[4]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–£—Å–ª—É–≥–∏"),t("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏ –¥–ª—è –±–ª–æ–∫–∞ —Ä–µ—à–µ–Ω–∏–π")],-1)),t("div",P,[t("button",{onClick:r[0]||(r[0]=n=>e.exportServices("csv")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",G,"...")):(a(),i("span",U,"üì•")),t("span",null,d(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç CSV"),1)],8,R),t("button",{onClick:r[1]||(r[1]=n=>e.exportServices("zip")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",q,"...")):(a(),i("span",Z,"üì¶")),t("span",null,d(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç ZIP"),1)],8,H),t("label",J,[t("input",{type:"file",accept:".zip,.csv,.txt",onChange:r[2]||(r[2]=(...n)=>e.handleImportFile&&e.handleImportFile(...n)),class:"hidden",disabled:e.loading||e.importing},null,40,K),e.importing?(a(),i("span",W,"...")):(a(),i("span",Q,"üì§")),t("span",null,d(e.importing?"–ò–º–ø–æ—Ä—Ç...":"–ò–º–ø–æ—Ä—Ç ZIP/CSV"),1)]),S(h,{to:{name:"admin.decisions.services.create"},class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},{default:z(()=>[...r[3]||(r[3]=[t("span",null,"+",-1),t("span",null,"–°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É",-1)])]),_:1})])]),e.loading?(a(),i("div",X,[...r[5]||(r[5]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥...",-1)])])):w("",!0),e.error?(a(),i("div",Y,[t("p",$,d(e.error),1)])):w("",!0),!e.loading&&e.services.length>0?(a(),i("div",ee,[t("div",te,[(a(!0),i(E,null,I(e.services,n=>(a(),i("div",{key:n.id,class:"p-4 hover:bg-muted/10 transition-colors flex items-center justify-between"},[t("div",re,[t("h3",oe,d(n.name),1),t("p",se," Slug: "+d(n.slug)+" | –ü–æ—Ä—è–¥–æ–∫: "+d(n.order)+" | "+d(n.is_active?"–ê–∫—Ç–∏–≤–Ω–∞":"–ù–µ–∞–∫—Ç–∏–≤–Ω–∞"),1)]),t("div",ne,[S(h,{to:{name:"admin.decisions.services.edit",params:{id:n.id}},class:"px-3 py-1.5 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors inline-block"},{default:z(()=>[...r[6]||(r[6]=[D(" –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",-1)])]),_:1},8,["to"]),t("button",{onClick:B=>e.deleteService(n),class:"px-3 py-1.5 text-sm bg-destructive/10 text-destructive hover:bg-destructive/20 rounded-lg transition-colors"}," –£–¥–∞–ª–∏—Ç—å ",8,ie)])]))),128))])])):w("",!0),!e.loading&&e.services.length===0?(a(),i("div",ae,[...r[7]||(r[7]=[t("p",{class:"text-muted-foreground"},"–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):w("",!0)])}const me=T(A,[["render",le]]);export{me as default};
